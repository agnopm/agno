#!/bin/sh -e

# get our vars
. $HOME/agno/agnorc

# untar package so we can work with files
mkdir -p $AGNO_WORK
cp "$1" "$AGNO_WORK"
cd $AGNO_WORK
tar xzf *.tar.gz

# copy usr dir, which should contain everything
rsync -av usr/ $AGNO_USR

# fill meta data about new package
# TODO: can we make this cleaner?
find . -type f | sed '/.tar.gz/d' > "$AGNO_META/$(basename $1 | cut -d\# -f1)"

# cleanup
rm -rf $AGNO_WORK

# notice
echo "Installed '$1' successfully (i.e. without errors)"
