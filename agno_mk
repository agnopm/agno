#!/bin/sh -e

# load relevant files
. $HOME/agno/agnorc
. ./Pkgfile

# re-define vars with new info
PKGNAME=$name\#$version-$release
AGNO_WORK=$AGNO_WORK/$PKGNAME
AGNO_SOURCE=$AGNO_SOURCE/$PKGNAME
AGNO_DESTDIR=$AGNO_DESTDIR/$PKGNAME

# download source files
mkdir -p $AGNO_SOURCE
cd $AGNO_SOURCE
for url in $source; do
	curl --ssl -L -O $url
done

# unpack files
for file in *; do
	$AGNO_HOME/unboop "$file"
done

# create work dir
mkdir -p $AGNO_WORK
if [ "$(ls -A $AGNO_SOURCE)" ]; then
	cp -R $AGNO_SOURCE/* $AGNO_WORK
fi

# run build function
cd $AGNO_WORK
agno_build

# gotta install that shiz diz
agno_install

# let's make a package out of the result
tar -czvf $PKGNAME.tar.gz $AGNO_DESTDIR
mv $PKGNAME.tar.gz $AGNO_PACKAGES

# we're done! let's cleanup
rm -rf $AGNO_WORK
rm -rf $AGNO_DESTDIR
